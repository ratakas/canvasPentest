"use strict";

$(document).ready(function () {
  var pathnames = window.location.pathname.split("/");
  var idwswork = pathnames[pathnames.length - 2];
  $("#new_workKK").confirm({
    title: 'Confirm!',
    content: 'Simple confirm!',
    buttons: {
      confirm: function confirm() {
        newwork();
      },
      cancel: function cancel() {
        $.alert('Canceled!');
      }
    }
  });
  $(".nav-tabs").on("click", "a", function (e) {
    e.preventDefault();
    $(this).tab('show');
  }).on("click", "span", function () {
    var anchor = $(this).siblings('a');
    $(anchor.attr('href')).remove();
    $(this).parent().remove();
    $(".nav-tabs li").children('a').first().click();
  });
  $(".select-ws").select2({
    theme: "bootstrap",
    width: 'resolve',
    ajax: {
      url: '/space_works/' + idwswork,
      processResults: function processResults(data) {
        return {
          results: data
        };
      }
    }
  });
  $('#mislect').on('select2:select', function (e) {
    var data = e.params.data;
    console.log("abrir en tab project" + data.id);
    abrirworktab(data.id);
  });
  $('#sn_info').summernote({
    disableDragAndDrop: true,
    placeholder: 'Hello bootstrap 4',
    tabsize: 0.5,
    height: 200,
    blockquoteBreakingLevel: 2,
    lineHeight: 5
  });
  $('#sn_notes').summernote({
    disableDragAndDrop: true,
    placeholder: 'notas',
    toolbar: [// [groupName, [list of button]]
    ['style', ['bold', 'italic', 'underline', 'clear']], ['fontsize', ['fontname', 'fontsize']], ['para', ['ul', 'ol', 'paragraph']]],
    height: 200
  });
  $('#sn_all').summernote({
    disableDragAndDrop: true,
    placeholder: 'notas',
    toolbar: [// [groupName, [list of button]]
    ['style', ['style', 'bold', 'italic', 'underline', 'clear']], ['fontsize', ['fontname', 'fontsize']], ['para', ['ul', 'ol', 'paragraph']], ['para', ['height', 'hr', 'table', 'picture', 'link', 'video', 'redo', 'undo', 'codeview', 'fullscreen']]],
    height: 500
  });
  var pathname = window.location.pathname.split("/");
  var idw = pathname[pathname.length - 1];
  var idws = pathname[pathname.length - 2];
  console.log(idws);
  console.log(idw);
  $.ajax({
    url: '/workspace_works/' + idws + '/' + idw,
    type: 'get',
    success: function success(result) {
      $("#w_id").text(result.id);
      $("#ws_name").text(result.name);
      $("#wstype_id").text(result.type);
      $("#work_id").text(result.Works[0].id);
      $("#w_name").text(result.Works[0].name);
      $("#w_host").text(result.Works[0].host);
      $("#sn_info").summernote('code', result.Works[0].inforelevant);
      $("#sn_notes").summernote('code', result.Works[0].inforeview);
      $("#sn_all").summernote('code', result.Works[0].infoall);
      $("#w_reportpdf").attr("href", "/reportpdf/" + result.Works[0].id);
      $("#w_reporthtml").attr("href", "/report/" + result.Works[0].id);
    }
  });
  $("#s_work").click(function () {
    var datas = {
      "name": $("#w_name").text(),
      "host": $("#w_host").text(),
      "inforelevant": $("#sn_info").summernote('code'),
      "inforeview": $("#sn_notes").summernote('code'),
      "infoall": $("#sn_all").summernote('code'),
      "state": true
    };
    console.log(datas);
    $.ajax({
      url: '/works/' + $("#work_id").text(),
      type: 'put',
      dataType: 'json',
      contentType: 'application/json',
      data: JSON.stringify(datas),
      success: function success(result) {
        console.log("datos del work save");
      }
    });
  });
});

function newwork() {
  var datawork = {
    "name": "Work  " + getfecha(),
    "host": "192.168.0.1",
    "inforelevant": "<h4><h5><h3><h4><ul><li>URLs:</li></ul><ul><li>User :&nbsp;</li></ul><ul><li>Passwords:</li></ul><p><br></p></h4></h3></h5></h4>",
    "inforeview": "<h4></h4><h5></h5><h3></h3><p><ul></ul><ul></ul><ul></ul></p><ul><li><br></li><li><br></li><li><br></li></ul>",
    "infoall": "<p></p><p></p><p></p><p><span style='font-size: 24px;'>Pruebas realizadas</span></p><hr><p></p><p><br></p><p><br></p><p></p><hr><br><p></p><p><br></p><hr><br><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p><br></p><hr><p><br></p><p><br></p><p><br></p><hr><p><br></p>",
    "creationdate": "na",
    "state": true,
    "worksapce_id": $("#w_id").text()
  };
  $.ajax({
    url: '/works',
    type: 'post',
    dataType: 'json',
    contentType: 'application/json',
    data: JSON.stringify(datawork),
    success: function success(datanewwork) {
      console.log("new proyec creado");
      $("#tab_name_work").append('<li><a href="#host_' + datanewwork.id + '" data-toggle="tab">Host ' + datanewwork.id + '</a></li>');
      $("#tab_content_woks").append(rendertab(datanewwork));
      createsummernote("sn_info_" + datanewwork.id);
      createsummernote("sn_notes_" + datanewwork.id);
      createsummernote("sn_all_" + datanewwork.id);
      $('#tab_name_work a[href="#host_' + datanewwork.id + '"]').tab('show');
    },
    error: function error(result) {
      console.log(result);
    }
  });
}
/**funciones */


function rendertab(data) {
  var buildhtml = "<div class=\"tab-pane fade\" id=\"host_".concat(data.id, "\">\n    <div class=\"content-work\" style=\"padding: 12px;\">\n                                <table class=\"table table-bordered\" style=\"margin-bottom: 5px;\">\n                                    <tbody>\n                                      <tr class=\"success\">\n                                          \n                                          <td style=\"width:12%;text-align: center; \"><h4>HOST</h4></td>\n                                        <th scope=\"row\" style=\"width:30%\"><h4 contenteditable=\"true\" id=\"w_host_").concat(data.id, "\">").concat(data.host, "</h4></th>                              \n                                        <td style=\"width:25%\"><H4 id=\"w_name_").concat(data.id, "\" contenteditable=\"true\">").concat(data.name, "</H4></td>\n                                        <td style=\"width:30%\">\n                                          <button onclick=\"w_update_work(").concat(data.id, ")\" class=\"btn btn-primary\">Save</button>\n                                          \n                                          \n                                          <div id=\"work_id_").concat(data.id, "\" class=\"hidden\"></div>\n                                          <a class=\"btn btn-warning\" href=\"/report/").concat(data.id, "\" target=\"_blank\" >Html</a>\n                                          <a class=\"btn btn-warning\" href=\"/reportpdf/").concat(data.id, "\" target=\"_blank\">Pdf</a>\n                                        </td>\n                                        \n                                      </tr>\n                                    </tbody>\n                                  </table>\n                                <div class=\"row\">\n                                  <div class=\"col-lg-8\" style=\"padding-right: 0px;\">\n                                      <div class=\"panel panel-primary\" style=\"margin-bottom: 3px\">\n                                          <div class=\"panel-heading\">\n                                            <h3 class=\"panel-title\">Relevant Information</h3>\n                                          </div>\n                                          <div class=\"panel-body\">\n                                              <div id=\"sn_info_").concat(data.id, "\">\n                                              ").concat(data.inforelevant, "\n                                              </div>\n                                          </div>\n                                        </div>\n                                        \n                                        \n                                  </div>\n                                  <div class=\"col-lg-4\">\n                                      <div class=\"panel panel-primary\" style=\"margin-bottom: 3px\">\n                                          <div class=\"panel-heading\">\n                                            <h3 class=\"panel-title\">Notes To Review</h3>\n                                          </div>\n                                          <div class=\"panel-body\">\n                                            <div id=\"sn_notes_").concat(data.id, "\">\n                                            ").concat(data.inforeview, "\n                                            </div>\n                                          </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class=\"row\">\n                                  <div class=\"col-lg-12\">\n                                      <div class=\"panel panel-primary\">                                          \n                                          <div class=\"panel-body\">\n                                            <div id=\"sn_all_").concat(data.id, "\">\n                                            ").concat(data.infoall, "\n                                            </div>\n                                          </div>\n                                        </div>\n                                  </div>                                    \n                                </div>  \n                            </div>\n\n  </div>");
  return buildhtml;
}

function getfecha() {
  var f = new Date();
  return f.getDate() + "/" + (f.getMonth() + 1) + "/" + f.getFullYear() + " " + f.getHours() + ":" + f.getMinutes() + ":" + f.getSeconds();
}

function createsummernote(namesummer) {
  $('#' + namesummer).summernote({
    disableDragAndDrop: true,
    placeholder: 'Hello',
    tabsize: 0.5,
    height: 200,
    blockquoteBreakingLevel: 2,
    lineHeight: 5
  });
}

function w_update_work(id) {
  var dataup = {
    "name": $("#w_name_" + id).text(),
    "host": $("#w_host_" + id).text(),
    "inforelevant": $("#sn_info_" + id).summernote('code'),
    "inforeview": $("#sn_notes_" + id).summernote('code'),
    "infoall": $("#sn_all_" + id).summernote('code'),
    "state": true
  };
  console.log(dataup);
  $.ajax({
    url: '/works/' + id,
    type: 'put',
    dataType: 'json',
    contentType: 'application/json',
    data: JSON.stringify(dataup),
    success: function success(result) {
      console.log("datos del work save");
    }
  });
}

function abrirworktab(id) {
  $.ajax({
    url: '/works/' + id,
    type: 'get',
    success: function success(datanewwork) {
      console.log("new proyec creado");
      $("#tab_name_work").append('<li><a href="#host_' + datanewwork.id + '" data-toggle="tab">Host ' + datanewwork.id + '</a><span>x</span></li>');
      $("#tab_content_woks").append(rendertab(datanewwork));
      createsummernote("sn_info_" + datanewwork.id);
      createsummernote("sn_notes_" + datanewwork.id);
      createsummernote("sn_all_" + datanewwork.id);
      $('#tab_name_work a[href="#host_' + datanewwork.id + '"]').tab('show');
    },
    error: function error(result) {
      console.log(result);
    }
  });
}