$(document).ready(function() {
    
    //Consultar
    $.ajax({
        url: '/api/chat',
        type: 'get',
        dataType: 'json',
        success: (result)=>{
            var meses = new Array ('Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre');
			var diasSemana = new Array('Domingo','Lunes','Martes','Miércoles','Jueves','Viernes','Sábado');
            result.forEach(item => {
                var f = new Date(item.created_at);
                var time_zone;

                (f.getHours >= 0 && f.getHours <= 12) ? time_zone = "AM" : time_zone= "PM";
                
                if (item.id % 2 == 0) {
                    
                    $("#content_Chat").append(`<div class="outgoing_msg">
                    <div class="sent_msg">
                      <p>${item.msg}</p>
                      <span class="time_date"> ${f.getHours()+ ':'+f.getMinutes()} ${time_zone}| ${diasSemana[ f.getDay()]+ ', ' + f.getDate() + ' de ' + meses[f.getMonth()]}</div>
                    </div>`);
                }else {
                    $("#content_Chat").append(`<div class="incoming_msg">
                    <div class="incoming_msg_img"> <img src="https://ptetutorials.com/images/user-profile.png" alt="sunil"> </div>
                      <div class="received_msg">
                        <div class="received_withd_msg">
                            <p>${item.msg}</p>
                            <span class="time_date"> ${f.getHours()+ ':'+f.getMinutes()} ${time_zone}| ${diasSemana[ f.getDay()]+ ', ' + f.getDate() + ' de ' + meses[f.getMonth()]}</div>
                        </div>
                      </div>
                  </div>`);
                }
            });

            $(".msg_history").animate({ scrollTop: $('.msg_history').prop("scrollHeight")}, 1000);
                  
        },
        error: (result)=>{
            console.log("error "+result);
            
        }
    });


    $('#content_Message').keypress(function(event){
	
        var keycode = (event.keyCode ? event.keyCode : event.which);
        if(keycode == '13'){
            add_Message();
        }
    
    });
    $("#new_record_chat").click(function() {
        
        add_Message();

    });
});

function add_Message() {
    var months = new Array ('Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre');
        
    $.ajax({
        url: '/api/chat',
        type: 'post',
        dataType: 'json',
        contentType: 'application/json',
        data: JSON.stringify(
            {msg:$("#content_Message").val()}
        ),
        success: (result)=>{
            var meses = new Array ('Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre');
            var diasSemana = new Array('Domingo','Lunes','Martes','Miércoles','Jueves','Viernes','Sábado');
            var f = new Date();
            var time_zone;

            (f.getHours >= 0 && f.getHours <= 12) ? time_zone = "AM" : time_zone= "PM";

            if (result.id % 2 == 0) {
                
                $("#content_Chat").append(`<div class="outgoing_msg">
                <div class="sent_msg">
                    <p>${result.msg}</p>
                    <span class="time_date"> ${f.getHours()+ ':'+f.getMinutes()} ${time_zone}| ${diasSemana[ f.getDay()]+ ', ' + f.getDate() + ' de ' + meses[f.getMonth()]}</div>
                </div>`);
            }else {
                $("#content_Chat").append(`<div class="incoming_msg">
                <div class="incoming_msg_img"> <img src="https://ptetutorials.com/images/user-profile.png" alt="sunil"> </div>
                    <div class="received_msg">
                    <div class="received_withd_msg">
                        <p>${result.msg}</p>
                        <span class="time_date"> ${f.getHours()+ ':'+f.getMinutes()} ${time_zone}| ${diasSemana[ f.getDay()]+ ', ' + f.getDate() + ' de ' + meses[f.getMonth()]}</div>
                    </div>
                    </div>
                </div>`);
            }

            $(".msg_history").animate({ scrollTop: $('.msg_history').prop("scrollHeight")}, 1000);
            $("#content_Message").val('');
            
        }
    });
}