import path from 'path';

const multer = require('multer');

module.exports = app =>{
let reqPath = path.join(__dirname, '../');

let nombrefile;

var storage = multer.diskStorage({
    destination: function (req, file, cb) {
      cb(null, path.join(reqPath+'public/uploads'))
    },
    filename: function (req, file, cb) {
        //let extArray = file.mimetype.toString().split("/");
        //let extension = extArray[extArray.length - 1];
       nombrefile = Date.now()+'-'+file.originalname;
      cb(null, nombrefile);
    }
  })
  
  var upload = multer({ storage: storage })

app.post('/uploadfile', upload.single('myFile'), (req, res, next) => {
    const file = req.file
    if (!file) {
      const error = new Error('Please upload a file')
      error.httpStatusCode = 400
      return next(error)
  
    }
      //7res.send(file)
    res.send(nombrefile);
  })

  app.post('/deletefile',(req, res)=>{
    console.log(req.body)

    var fs = require('fs');
    fs.unlink(reqPath+'public/uploads/'+req.body.name, (err) => {
      //if (err) throw res.status(412).json({msg: err.message});
      var aux;
      if (err){
        
      }else{
        res.json({"msm":"delete ok"})
      }
      
    });


  });


}